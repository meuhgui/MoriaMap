plugins {
    id 'java'
    id 'application'
    id 'idea'
    id 'jacoco'
    id "org.sonarqube" version "3.5.0.2730"
}

group 'dev.moriamap'
version '0.1'
mainClassName = group + '.Main'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation(platform('org.junit:junit-bom:5.7.0'))
    testImplementation 'org.junit.jupiter:junit-jupiter'
}

tasks.named('test') {
    useJUnitPlatform()
    finalizedBy jacocoTestReport
}

jacocoTestReport {
    dependsOn test
    sourceDirectories.from files(sourceSets.main.allJava.srcDirs)

    reports {
        xml.required = true
    }
    finalizedBy jacocoTestCoverageVerification
}

jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = 0.75
            }
        }
    }
}

jar {
    manifest {
        attributes 'Main-Class': mainClassName
    }
    archiveFileName = 'MoriaMap.jar'
}

sonar {
    properties {
        property "sonar.login", "admin"
        property "sonar.password", "F9Erj73eUynRrGP"
    }
}

run {
    standardInput = System.in
}
